* Ван Синь P3404c
* forth | stack | neum | hw | instr | binary | trap | mem | pstr | prob2 | spi

## forth программирование дизайн
* Сами инструкции не чувствительны к регистру, за исключением объявлений символов. Например, ld #1 равен LD #1.
* Первая функция — _start, она является входной.
* Инструкции выполняются последовательно. Действие инструкции объясняется следующим образом:

  - `@ аргумент ` -- загрузка. Загрузите значение переменной

  - `! аргумент ` -- Установить значение. Присвоить значение переменной

  - `+ аргумент ` -- Добавить указанное значение в регистр

  - `- аргумент` -- Удалить указанное значение из регистра

  - `* аргумент ` -- Умножить регистр на указанное значение

  - `/ аргумент ` -- Разделить регистр на указанное

  - `if аргумент` -- сравнивает значение регистра с указанным значением и устанавливает значение статуса

  - `do` -- Начало цикла
  
  - `loop` -- Конец цикла
  
  - `leave` -- Выйдите из цикла
  
  - `;` -- Программа завершается, выходим из программы

  - `. "String` -- Вывод содержимого строки
  
  -  `@+!`  -- Добавить и назначить

* Кодировка символов поддерживается. Символы хранятся в памяти в виде чисел:

```

' ':0, 'a':1, 'b':2, 'c':3, 'd':4, 'e':5, 'f':6, 'g':7, 'h':8, 'i':9, 'j':10,
'k':11, 'l':12, 'm':13, 'n':14, 'o':15, 'p':16, 'q':17, 'r':18, 's':19, 't':20,
'u':21,'v':22, 'w':23, 'x':24, 'y':25, 'z':26, 'A':27, 'B':28, 'C':29, 'D':30, 
'E':31, 'F':32,'G':33, 'H':34, 'I':35, 'J':36, 'K':37, 'L':38, 'M':39, 'N':40, 
'O':41, 'P':42, 'Q':43,'R':44, 'S':45, 'T':46, 'U':47, 'V':48, 'W':49, 'X':50, 
'Y':51, 'Z':52, '':53, '0':54,'1':55, '2':56, '3':57, '4':58, '5':59, '6':60, 
'7':61, '8':62, '9':63, '!':64, ',':65,'.':66, '-':67, '*':68, '?':69, '+':70, 
'/':71, '@':72, '\0':73, '\n':74

```

* Контрольная этикетка:

 - 'variable var_name var_value' - Указывает на объявление переменной и присвоение значения. Например, предел переменной 4000000 определяет предел переменной и присваивает ему значение 4000000.

* Код и исполнение:

  * Определение кода следующее： :Код выполнения начинается с": _start"и заканчивается ";"

  Разница между функциями и метками заключается в том, что метки начинаются с "." .Когда мы хотим перейти к определенному тегу, нам нужно использовать его следующим образом:
    jmp .label_name

* Поиск адреса (формат параметра):

  * Чистые числа: если аргумент является числом, он рассматривается как адрес. То есть ld 29 - означает загрузку значения 30-й ячейки в аккумулятор
  * Просто значение: если параметр имеет знак «#», за которым следует число, параметр рассматривается как значение. т.е. ld #29 - загрузить 29 в батарею
  * Переменная: если аргументом является переменная, определенная в разделе данных, то адрес рассматривается как переменная.
  * Символ: Закодирован в числа в соответствии с таблицей символов. Например, ld 'A' = ld #27.

* Определение значения статуса:

  * N = 1
  * Z = 2
  * V = 4
  * C = 8

* Определения переменных：

  * Определяется следующим образом：“<Name： Value>'。 Значение может быть числом или строкой. Если это строка, в ней будет столько ячеек, сколько символов.
## Память

Память команд и данных.

Память — это список ячеек. Ячейки реализуются классом Cell.

* или число – т.е. данные. Машинные биты - 32 бита. **Ячейка содержит только один символ. Этот символ также принимает числовую форму в соответствии с таблицей символов, определенной в ISA**.
* Или инструкция, выраженная в виде класса - Instruction。**В объекте класса инструкция хранит тип и параметры инструкции.**

Дизайн стека.

Последняя часть **1/4** — это порт ввода-вывода, он используется только для ввода-вывода.

### Система команд

* Машинные биты -- 32 бита.
*Регистр:

   * IP-счетчик
     *общаться-
       * Регистр
       * Заимствовать из стека
       * Сохраняйте результаты любой функции
       * Сохраняйте результаты любых математических операций
     * BR — служит буфером для временного хранения данных. Например, он используется для сохранения результата функции в инструкции ret.
     *AR — назначенный адрес объекта, с которым они взаимодействуют, то есть реестра. Все еще говоришь? «Адрес» стека.
     *PS – код состояния.
     *SP — указатель стека.

## Кодирование инструкций

Машинный код хранится в формате CSV

Вся программа разделена на 4 части. отличающиеся указанными тегами,

- Первая часть инструкций перед тегом FUNCTION представляет собой набор инструкций. Каждая строка содержания инструкции разделена на три столбца со знаком " ":
   - Первый столбец - это индекс инструкции.
   - Второй столбец - инструкции
   - Параметры третьего столбца (если есть)
- Вторая часть — это функция. Содержимое после FUNCTION и перед LABEL — это выполняемая функция. Каждая строка содержимого функции разделена на два столбца со знаком ":":
   - Первый столбец - это имя
   - Второй столбец - индекс инструкции
– Третья часть — это метка. Содержимое после LABEL и перед VARIABLE — это метка. Каждая строка содержимого метки разделена на три столбца со знаком ":":
   - Первый столбец - это имя функции
   - Второй столбец — название ярлыка.
   -Третий столбец — индекс инструкций.
— Четвертая часть — это переменная, а содержимое после тега VARIABLE — это переменная. Переменные разделены на три столбца со знаком ":":
   - Первый столбец — это имя переменной
   - Второй столбец - значение
   - Третий столбец - длина строки (если есть)

Например:

```
0 DO 
1 @ INPUT 
2 IF @=-1 
3 LEAVE 
4 . OUTPUT 
5 LOOP 
6 ; 
FUNCTION
_START:0
LABEL
_START:DO:1
_START:LEAVE:6
_START:LOOP:1
VARIABLE
```


## Переводчик

Выполните команду: `translator.py <input_file> <target_file>"`

Поддержка определения основных ошибок:

* Невозможно определить две переменные с одинаковым именем.
* Не используйте “Input” или “Output”в качестве имен переменных.
* Проверьте, правильно ли пользователь определил параметры. Например, вы можете определить параметры для директивы, у которой нет параметров.
* Проверьте формат переменной.
* В сообщении об ошибке будет указано место возникновения ошибки.

Функция переводчика：

1. Проверьте некоторые этикетки. данные
2. Считайте переменные и сохраните их в
3. Проверьте некоторые этикетки
4. Прочтите код
    * Если строка является меткой, сохраняется ее положение, включая функцию и имя на кириллице label_in_fun.
    * Если строка является функцией, она сохраняет свою позицию и имя в function_point.
    * Если строка является директивой, сохраните ее позицию, тип и аргументы в результирующей строке.
5. Когда читает строку, автоматически игнорирует комментарии
6. Директива преобразуется в верхний регистр перед выполнением какой-либо обработки цифр 1–4.
7. Сгенерируйте выходные файлы на основе результатов, переменных, label_in_fun и function_point.

## Компьютерное моделирование

Выполнение заказа: `machine.py <target_file> <inputfile>".`

Процессор：

* Операции над одним и тем же объектом не выполняются за один такт.
* Выполняйте операции над разными объектами в одном цикле.

Реализация алгоритма:
* problem5： /asm/prob2.fth
* cat     : /asm/cat.fth
* hello   : /asm/hello.fth

## Ручное тестирование:

* Машинное тестирование：test_machine.py
* Тест перевода：test_translator.py

## Автоматическое тестирование：
  GIT-адрес：https://github.com/TeacherChen1990/prob2
  После отправки кода (основная ветвь) автоматически запустится обнаружение приложения Python, а файлы test_machine.py и test_translator.py будут автоматически выполнены, и обнаружение пройдет успешно.

